# IDPG Output Directory

This directory contains visualizations generated by the IDPG (Intensity Dot Product Graph) example scripts. The plots are organized by topic to facilitate exploration of different aspects of the model.

## Implementation Overview

### Mathematical Framework

IDPG extends Random Dot Product Graphs (RDPG) by making nodes stochastic. The key idea is:

1. **Latent Space**: B^d_+ (non-negative unit ball) = {x in R^d : x >= 0, ||x|| <= 1}

2. **Intensity Function**: rho(g, r) defines the density of "interaction sites" on B^d_+ x B^d_+
   - Each site has two latent positions: g (source/giving) and r (receiver/target)
   - Product intensity: rho(g, r) = rho_G(g) * rho_R(r) enables closed-form analysis

3. **Poisson Point Process**: Sites are sampled from a PPP with intensity rho
   - Expected number of sites: E[N] = integral of rho = c_G * c_R (for product intensity)

4. **Connection Mechanism**: P(i -> j) = g_i . r_j (dot product)
   - This creates directed graphs where sending and receiving are decoupled
   - Asymmetric: P(i -> j) != P(j -> i) in general

### Two Interpretations

**Node-Centric** (long-lived entities):
- Each sampled site becomes a node
- Edges form independently with probability g_i . r_j
- E[|E|] = E[N]^2 * (mu_tilde_G . mu_tilde_R)

**Edge-Centric** (ephemeral interactions):
- Each sampled site IS an interaction/edge
- E[L] = E[N] * (mu_tilde_G . mu_tilde_R)
- Ratio: E[|E|] / E[L] = E[N]

### Key Quantities

- c_G, c_R: Total marginal intensities
- mu_G, mu_R: Intensity-weighted mean positions
- mu_tilde_G = mu_G / c_G: Normalized mean (average latent position)
- avg_conn_prob = mu_tilde_G . mu_tilde_R: Average connection probability

---

## Directory Structure

```
output/
├── basics/              # Basic IDPG demonstrations
├── graphs/              # Graph structure visualizations
├── validation/          # Formula validation plots
├── mesoscale/           # Mesoscale network analysis
├── applications/        # Application examples (ecology, 4D food webs)
├── dynamics/            # PDE evolution (diffusion on B^d_+)
└── temporal_foodweb/    # Temporal evolution under different PDE regimes
```

---

## Plot Descriptions

### basics/

#### `basic_idpg.png`
**Script**: `examples/basic_idpg.jl`

Basic demonstration of IDPG sampling and graph generation. Shows:
- Intensity function visualization on B^2_+
- Sampled interaction sites in latent space
- Node-centric graph with spring layout
- Edge-centric sample visualization

**What to look for**: The clustering of sites reflects the intensity function shape. Nodes with similar g positions tend to have similar out-degree patterns.

---

### graphs/

#### `graph_visualization.png`
**Script**: `examples/graph_visualization.jl`

Six-panel visualization of directed graph structure:

1. **Top-left**: Node positions in G-space (source propensity)
   - Green dots show where nodes are positioned for "sending" edges

2. **Top-middle**: Node positions in R-space (target propensity)
   - Red dots show where nodes are positioned for "receiving" edges

3. **Top-right**: Directed graph with spring layout
   - Shows the realized network with arrows indicating edge direction

4. **Bottom-left**: Directed graph embedded in G-space
   - Arrows overlay the latent positions to show connection patterns

5. **Bottom-middle**: Why edges form (P(i->j) = g_i . r_j)
   - Shows g (circle) and r (diamond) positions for individual nodes
   - Demonstrates decoupling of sending/receiving propensities

6. **Bottom-right**: Edge-centric sample
   - Arrows from source to target positions for ephemeral interactions

**What to look for**: The orthogonal placement of G and R means clusters (g near (0.65, 0.15), r near (0.15, 0.65)) results in moderate connectivity since (0.65, 0.15) . (0.15, 0.65) ~ 0.2.

#### `graph_directed.png`
**Script**: `examples/graph_visualization.jl`

Focused view of a single directed graph:
- Nodes colored by ||g|| (source strength) using viridis colormap
- Brighter yellow = higher sending propensity
- Spring layout reveals community structure
- Arrows show edge directions

**What to look for**: Color gradients may reveal hub structure - bright nodes send more edges.

#### `graph_simple.png`
**Script**: Earlier version of graph visualization

Simple graph visualization for quick inspection.

---

### validation/

#### `product_case_validation.png`
**Script**: `examples/product_case.jl`

Three-panel log-log validation of theoretical formulas:

1. **Node Count**: E[N] theory vs empirical
2. **Node-Centric Edges**: E[|E|] = E[N]^2 * (mu_tilde_G . mu_tilde_R)
3. **Edge-Centric Edges**: E[L] = E[N] * (mu_tilde_G . mu_tilde_R)

Red dashed line = perfect agreement (y = x).

**What to look for**: Points should fall on or near the diagonal line. Systematic deviations would indicate formula errors or implementation bugs. The log-log scale spans ~3 orders of magnitude.

---

### mesoscale/

#### `mesoscale_metrics.png`
**Script**: `examples/mesoscale_metrics.jl`

Nine-panel analysis of network structure beyond global statistics:

**Row 1**:
1. **Reciprocity Distribution**: Fraction of reciprocated edges
   - Expected: avg_conn_prob (since edges are independent)

2. **Degree Independence Test**: Correlation between in-degree and out-degree
   - Expected: ~0 (g and r are independent in product intensity)

3. **Clustering Distribution**: Directed transitivity coefficient

**Row 2**:
4. **Giant SCC Fraction**: Largest strongly connected component / N
5. **Degree Assortativity**: Do high out-degree nodes connect to high in-degree?
6. **PageRank Inequality (Gini)**: Heterogeneity in node "importance"

**Row 3**:
7. **Example In-Degree Distribution**: Shape of in-degree for one realization
8. **Example Out-Degree Distribution**: Shape of out-degree for one realization
9. **In vs Out Degree Scatter**: Tests g/r independence

**What to look for**:
- Reciprocity should match avg_conn_prob (red line)
- In/out correlation should be near 0
- High giant SCC fraction indicates well-connected graphs

#### `mesoscale_comparison.png`
**Script**: `examples/mesoscale_metrics.jl`

Reciprocity across three connectivity regimes:
1. **Aligned (high conn)**: G and R means aligned -> high dot product
2. **Orthogonal (medium)**: G and R means nearly orthogonal
3. **Very orthogonal (low)**: G and R means maximally orthogonal

**What to look for**: Reciprocity tracks avg_conn_prob across regimes, confirming edge independence.

#### `idpg_vs_er_comparison.png`
**Script**: `examples/idpg_vs_erdos_renyi.jl`

Key comparison: Does IDPG have structure beyond Erdos-Renyi?

Grid of histograms comparing IDPG (blue) vs matched ER (orange) across:
- **Clustering**: Transitivity coefficient
- **Degree Var/Mean**: Coefficient of dispersion (key discriminator!)
- **In-degree Std**: Degree heterogeneity
- **Assortativity**: Degree-degree correlations

Three rows = three intensity configurations.

**What to look for**:
- **Degree Var/Mean** shows complete separation: IDPG >> ER
- This is THE signature of latent space heterogeneity
- ER has Var/Mean ~ 1 (Poisson), IDPG can have 10-20x higher

#### `idpg_vs_er_degrees.png`
**Script**: `examples/idpg_vs_erdos_renyi.jl`

Single-realization comparison of degree distributions:
1. **Out-Degree Distribution**: IDPG vs ER
2. **In-Degree Distribution**: IDPG vs ER
3. **In vs Out Scatter**: Node-level degree comparison

**What to look for**: IDPG distributions are wider/more spread than ER, reflecting heterogeneous connection probabilities P(i->j) = g_i . r_j.

#### `connection_probability_heterogeneity.png`
**Script**: `examples/idpg_vs_erdos_renyi.jl`

Explains WHY IDPG differs from ER:
1. **Left**: Distribution of P(i->j) across all node pairs
   - ER would be a single spike at p
   - IDPG shows spread due to varying g_i . r_j products

2. **Right**: Node propensity scatter
   - Each point = one node
   - X = sum_j P(i->j) (expected out-degree)
   - Y = sum_j P(j->i) (expected in-degree)
   - ER: all points at same location
   - IDPG: spread reflects latent position heterogeneity

---

### applications/

#### `ecological_foodweb.png`
**Script**: `examples/ecological_example.jl`

Ecological network (food web) generated with IDPG in 2D:
- Models predator-prey interactions
- Bimodal intensity creates trophic levels
- Shows how IDPG captures ecological network structure

#### `ecological_4d_comparison.png`
**Script**: `examples/ecological_4d_example.jl`

Side-by-side comparison of 2D vs 4D latent spaces for food web modeling:
- 4D allows more distinct trophic niches (each dimension = trophic level)
- Uses hyperspherical coordinates to define guild positions
- Shows food web graphs and interaction count heatmaps

#### `ecological_4d_variability.png`
**Script**: `examples/ecological_4d_example.jl`

2x2 grid showing variability across 4 independent samples:
- Demonstrates stochastic nature of IDPG sampling
- Same intensity function produces different realized networks
- Uses nearest-guild assignment (not k-means) for consistent labeling

#### `ecological_4d_detailed.png` and `ecological_4d_filtered_web.png`
**Script**: `examples/ecological_4d_example.jl`

Detailed analysis of 4D food web structure:
- Average interaction counts across 50 trials
- Expected vs observed interaction matrices
- Filtered food web showing only significant edges

---

### dynamics/

#### `diffusion_evolution.png`
**Script**: `examples/diffusion_example.jl`

PDE evolution of intensity function over time:
- Diffusion on B^d_+ with absorbing boundary
- Shows how intensity spreads and decays
- Tracks total intensity and graph statistics over time

**What to look for**: Mass spreads from initial concentration, decreases due to absorbing boundary at ||x|| = 1.

---

### temporal_foodweb/

#### `regime_comparison_heatmaps.png`
**Script**: `examples/temporal_foodweb.jl`

Food web structure at t=0 and t=1 under four PDE regimes:
- **Static**: No evolution (baseline)
- **Diffusion**: Niches spread (D=0.08)
- **Advection**: Niches shift uniformly (v=[0.4, 0.3, -0.1, 0])
- **Pursuit-Evasion**: Coupled dynamics (resources flee, consumers chase)

#### `interaction_counts.png`
**Script**: `examples/temporal_foodweb.jl`

Total interaction count over time for each regime:
- Static remains constant (~72 interactions)
- Diffusion decreases as niches spread
- Advection may increase or decrease depending on direction
- Pursuit-Evasion shows dramatic decrease (~25 interactions at t=1)

#### `final_foodwebs.png`
**Script**: `examples/temporal_foodweb.jl`

Food web graph structure at final time (t=1) for each regime:
- Trophic layout: Producers at bottom, Apex at top
- Edge width proportional to interaction frequency
- Shows how different dynamics affect network topology

#### `mean_trajectories.png`
**Script**: `examples/temporal_foodweb.jl`

Intensity mean position trajectories (projected to first 2 dimensions):
- Circle = start, Star = end
- Shows how resource (rho_G) and consumer (rho_R) means move
- Pursuit-evasion shows diverging trajectories

#### `pursuit_evasion_filmstrip.png`
**Script**: `examples/temporal_foodweb.jl`

Time-lapse of food web under pursuit-evasion dynamics:
- 5 snapshots from t=0 to t=1
- Shows progressive weakening of trophic links
- Demonstrates co-evolutionary dynamics

---

## Regenerating Plots

To regenerate any plot, run the corresponding example script:

```bash
# From repository root
julia --project=. examples/basic_idpg.jl
julia --project=. examples/graph_visualization.jl
julia --project=. examples/product_case.jl
julia --project=. examples/mesoscale_metrics.jl
julia --project=. examples/idpg_vs_erdos_renyi.jl
julia --project=. examples/ecological_example.jl
julia --project=. examples/ecological_4d_example.jl
julia --project=. examples/diffusion_example.jl
julia --project=. examples/temporal_foodweb.jl
```

## Key Findings Summary

1. **Formula Validation**: All theoretical predictions (E[N], E[|E|], E[L]) match empirical sampling

2. **Mesoscale Structure**: IDPG graphs exhibit consistent mesoscale properties:
   - Reciprocity ~ avg_conn_prob (edge independence)
   - In/out degree uncorrelated (g/r independence in product intensity)
   - High clustering despite no explicit clustering mechanism

3. **IDPG vs ER**: IDPG is NOT just Erdos-Renyi:
   - Key discriminator: degree variance/mean ratio
   - IDPG has 2-20x higher degree heterogeneity
   - Source: varying connection probabilities P(i->j) = g_i . r_j

4. **Latent Space Geometry**:
   - Orthogonal G/R means -> sparse graphs
   - Aligned G/R means -> dense graphs
   - Concentrated intensity (high kappa) -> more homogeneous (ER-like)
   - Spread intensity (low kappa) -> more heterogeneous
